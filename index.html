<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€–á€½á€„á€·á€ºá€Ÿ (Pwin Ha) - á€á€…á€ºá€†á€„á€·á€ºá€á€»á€„á€ºá€¸á€™á€±á€¸ à¤‰à¤¤à¥à¤¤à¤°</title>

    <!-- ======== App Icon Links ======== -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/gemini-pro-chat/gemini-pro-chat.github.io/main/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/gemini-pro-chat/gemini-pro-chat.github.io/main/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/gemini-pro-chat/gemini-pro-chat.github.io/main/assets/favicon-16x16.png">

    <!-- ======== Stylesheets ======== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --primary-accent: #E91E63; --secondary-accent: #26A69A; --background-main: #FDF8F5;
            --card-bg: #FFFFFF; --text-dark: #212529; --text-light: #6c757d;
            --border-color: #E0E0E0; --prompt-bg: #F1F5F9;
            --shadow-sm: 0 2px 4px rgb(0 0 0 / 5%); --shadow-md: 0 4px 8px rgb(0 0 0 / 7%); --shadow-lg: 0 10px 20px rgb(0 0 0 / 10%);
        }
        body { font-family: 'Pyidaungsu', sans-serif; background-color: var(--background-main); color: var(--text-dark); padding: 2rem 0; }
        .main-container { max-width: 500px; }
        .card {
            border: 1px solid var(--border-color); border-radius: 1.5rem; box-shadow: var(--shadow-lg); padding: 1.5rem;
            animation: cardFadeIn 0.6s ease-out forwards; opacity: 0; transform: translateY(20px);
        }
        @keyframes cardFadeIn { to { opacity: 1; transform: translateY(0); } }
        .btn {
            font-weight: 700; border-radius: 50rem; padding: 0.75rem 1.5rem;
            transition: all 0.25s ease-in-out; box-shadow: var(--shadow-sm); border: none;
        }
        .btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .btn-primary { background-color: var(--primary-accent); color: white; }
        .btn-primary:hover { background-color: #C2185B; }
        .btn-secondary { background-color: var(--secondary-accent); color: white; }
        .btn-secondary:hover { background-color: #00897B; }
        .btn-outline-primary { border: 2px solid var(--primary-accent); color: var(--primary-accent); background-color: transparent; }
        .btn-outline-primary:hover { background-color: var(--primary-accent); color: white; }
        .form-control, .form-select { border-radius: 0.75rem; padding: 0.75rem 1rem; border: 1px solid var(--border-color); }
        .form-control:focus { border-color: var(--primary-accent); box-shadow: 0 0 0 0.2rem rgb(233 30 99 / 25%); }
        .header-title { display: flex; align-items: center; justify-content: center; gap: 0.75rem; font-size: 2.5rem; font-weight: 700; color: var(--text-dark); }
        .loading-spinner { display: inline-block; width: 1rem; height: 1rem; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 0.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .hidden { display: none !important; }
        .whitespace-pre-wrap { white-space: pre-wrap; }
        .mood-selector { display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: center; }
        .mood-option { padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 50rem; cursor: pointer; transition: all 0.2s ease-in-out; background-color: var(--card-bg); }
        .mood-option:hover { transform: scale(1.05); border-color: var(--primary-accent); }
        .mood-option.active { background-color: var(--primary-accent); color: white; border-color: var(--primary-accent); font-weight: bold; }
        .progress-bar { background-color: var(--primary-accent); transition: width 0.4s ease-in-out; }
        .prompt-container { background-color: var(--prompt-bg); border-radius: 1rem; }
        .analysis-section { background-color: #f0fff4; border: 1px solid #a7e0b4; color: var(--text-dark); }
        .history-item:hover { background-color: #f1f5f9; cursor: pointer; }
    </style>
</head>
<body class="d-flex align-items-center justify-content-center">
    <div class="container main-container">
        <div class="card p-3 p-md-4">
            <header class="d-flex justify-content-between align-items-center mb-4">
                <div class="header-title flex-grow-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                    <span>á€–á€½á€„á€·á€ºá€Ÿ</span>
                </div>
                <button id="settingsBtn" class="btn btn-light rounded-circle" style="width: 45px; height: 45px;" title="á€†á€€á€ºá€á€„á€ºá€™á€»á€¬á€¸"><i class="bi bi-gear-fill fs-5"></i></button>
            </header>
            
            <main id="app-content" role="main">
                <!-- All sections will be dynamically shown/hidden -->
                <section id="journalSection" class="section"></section>
                <section id="settingsSection" class="section hidden"></section>
                <section id="promptsSection" class="section hidden"></section>
                <section id="analysisSection" class="section hidden"></section>
                <section id="journalHistorySection" class="section hidden"></section>
            </main>
        </div>
        
        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- TEMPLATING: HTML content for different sections ---
        const templates = {
            journalSection: `
                <div class="mb-4">
                    <label for="journalDate" class="form-label fw-bold">á€›á€€á€ºá€…á€½á€²:</label>
                    <input type="date" id="journalDate" class="form-control" required>
                </div>
                <div class="mb-4">
                    <label class="form-label fw-bold mb-3">á€œá€€á€ºá€›á€¾á€­á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯:</label>
                    <div id="journalMood" class="mood-selector">
                       <div class="mood-option" data-value="á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€º">ğŸ˜Š á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€º</div> <div class="mood-option" data-value="á€á€™á€ºá€¸á€”á€Šá€ºá€¸">ğŸ˜¢ á€á€™á€ºá€¸á€”á€Šá€ºá€¸</div>
                       <div class="mood-option" data-value="á€…á€­á€á€ºá€á€­á€¯">ğŸ˜  á€…á€­á€á€ºá€á€­á€¯</div> <div class="mood-option" data-value="á€…á€­á€á€ºá€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸">ğŸ¤© á€…á€­á€á€ºá€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸</div>
                       <div class="mood-option" data-value="á€„á€¼á€­á€™á€ºá€á€€á€º">ğŸ˜Œ á€„á€¼á€­á€™á€ºá€á€€á€º</div> <div class="mood-option" data-value="á€•á€„á€ºá€•á€”á€ºá€¸">ğŸ˜´ á€•á€„á€ºá€•á€”á€ºá€¸</div>
                       <div class="mood-option" data-value="á€…á€­á€á€ºá€›á€¾á€¯á€•á€º">ğŸ˜• á€…á€­á€á€ºá€›á€¾á€¯á€•á€º</div> <div class="mood-option" data-value="á€€á€»á€±á€”á€•á€º">ğŸ‘ á€€á€»á€±á€”á€•á€º</div>
                    </div>
                    <input type="hidden" id="selectedMood" value="">
                </div>
                <div class="mt-4 text-center d-grid gap-3">
                    <h3 class="h5 mb-2 fw-bold">á€˜á€šá€ºá€œá€­á€¯ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€­á€¯á€¸á€›á€±á€¸á€™á€œá€²á‹</h3>
                    <button id="startMorningBtn" class="btn btn-primary">ğŸŒ… á€™á€”á€€á€ºá€á€„á€ºá€¸ á€™á€¾á€á€ºá€á€™á€ºá€¸</button>
                    <button id="startNightBtn" class="btn btn-primary">ğŸŒƒ á€Šá€•á€­á€¯á€„á€ºá€¸ á€™á€¾á€á€ºá€á€™á€ºá€¸</button>
                    <button id="startGratitudeBtn" class="btn btn-secondary">ğŸ™ á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€á€¼á€„á€ºá€¸</button>
                    <button id="startGeneralBtn" class="btn btn-light border">ğŸ’¬ á€¡á€‘á€½á€±á€‘á€½á€± á€›á€„á€ºá€–á€½á€„á€·á€ºá€á€¼á€„á€ºá€¸</button>
                    <hr>
                    <button id="myJournalBtn" class="btn btn-outline-primary">ğŸ“– á€€á€»á€½á€”á€ºá€¯á€•á€ºá á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸</button>
                </div>
            `,
            promptsSection: `
                <h2 id="prompt-title" class="h3 fw-bold text-center mb-4"></h2>
                <div class="progress mb-3" role="progressbar" aria-label="á€™á€±á€¸á€á€½á€”á€ºá€¸á€á€­á€¯á€¸á€á€€á€ºá€™á€¾á€¯" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="height: 8px;">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <div class="p-4 rounded mb-3 prompt-container">
                    <p id="currentPromptText" class="h5 mb-3 text-center"></p>
                    <textarea id="promptAnswerTextarea" class="form-control" rows="5" placeholder="á€á€„á€·á€ºá€¡á€–á€¼á€±á€€á€­á€¯ á€¤á€”á€±á€›á€¬á€á€½á€„á€º á€›á€±á€¸á€á€¬á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€º..."></textarea>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <button id="prevPromptBtn" class="btn btn-outline-primary" disabled>á€šá€á€„á€ºá€™á€±á€¸á€á€½á€”á€ºá€¸</button>
                    <span id="promptCounter" class="text-muted fw-bold"></span>
                    <button id="nextPromptBtn" class="btn btn-primary">á€”á€±á€¬á€€á€ºá€™á€±á€¸á€á€½á€”á€ºá€¸</button>
                    <button id="combineAnswersBtn" class="btn btn-secondary hidden">AI á€¡á€€á€¼á€¶á€‰á€¬á€á€ºá€›á€šá€°á€™á€Šá€º</button>
                </div>
                <div class="text-center mt-3">
                    <button id="backToMainFromPromptsBtn" class="btn btn-sm btn-light">á€•á€„á€ºá€™á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬á€á€­á€¯á€·</button>
                </div>
            `,
            analysisSection: `
                <h2 class="h3 fw-bold text-center mb-4">AI á á€á€¯á€¶á€¸á€á€•á€ºá€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º</h2>
                <div class="analysis-section p-3 rounded mb-4">
                    <h3 class="h5 mb-2 fw-bold" style="color: #00897B;">AI á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º</h3>
                    <p id="aiSuggestionDisplay" class="text-dark whitespace-pre-wrap"></p>
                </div>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="h5 mb-2 fw-bold">á€á€„á€ºá á€¡á€á€½á€±á€¸á€¡á€™á€¼á€„á€ºá€™á€»á€¬á€¸</h3>
                        <textarea id="combinedJournalText" class="form-control" rows="10" readonly></textarea>
                        <div class="d-grid gap-2 mt-3">
                            <button id="copyCombinedTextBtn" class="btn btn-secondary">á€™á€¾á€á€ºá€á€™á€ºá€¸á€€á€°á€¸á€šá€°á€™á€Šá€º</button>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3 d-grid">
                    <button id="backToMainJournalBtn" class="btn btn-outline-primary">á€•á€„á€ºá€™á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬á€á€­á€¯á€·</button>
                </div>
            `
            // Other templates (settings, history) can be added here as needed.
        };

        // --- UTILITIES & SERVICES (Storage, UI, Gemini) ---
        const StorageUtil = {
            save: (key, value) => { try { localStorage.setItem(key, JSON.stringify(value)); } catch (e) { console.error("Error saving to LS:", e); } },
            load: (key) => { try { const value = localStorage.getItem(key); return value ? JSON.parse(value) : null; } catch (e) { console.error("Error loading from LS:", e); return null; } }
        };

        const UIUtil = {
            render: (sectionId, template) => { document.getElementById(sectionId).innerHTML = template; },
            showSection: (id) => { document.querySelectorAll('.section').forEach(s => s.classList.add('hidden')); document.getElementById(id)?.classList.remove('hidden'); },
            showToast: (msg, type = 'dark') => {
                const toastContainer = document.querySelector('.toast-container');
                const toastEl = document.createElement('div');
                toastEl.className = `toast align-items-center text-bg-${type} border-0`;
                toastEl.innerHTML = `<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
                toastContainer.appendChild(toastEl);
                new bootstrap.Toast(toastEl, { delay: 5000 }).show();
            },
            setLoading: (el, loading, text) => { el.disabled = loading; el.innerHTML = loading ? `<span class="loading-spinner"></span>${text}` : text; }
        };

        const GeminiAPI = {
            // NOTE: The full GeminiAPI object from previous versions should be pasted here.
            // It is omitted for brevity but is required for the app to function.
            async fetchPrompts(mode, mood, name, apiKey) { return ["á€™á€±á€¸á€á€½á€”á€ºá€¸ á", "á€™á€±á€¸á€á€½á€”á€ºá€¸ á‚", "á€™á€±á€¸á€á€½á€”á€ºá€¸ áƒ"]; }, // Placeholder
            async fetchCounselorAdvice(journalText, mood, mode, apiKey) { return "á€’á€«á€€á€á€±á€¬á€· AI á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€•á€«á€•á€²á‹"; } // Placeholder
        };
        
        // --- MAIN APPLICATION LOGIC ---
        class JournalApp {
            constructor() {
                this.isLoading = false;
                this.journalMode = null;
                this.journalEntries = StorageUtil.load('journalEntries') || [];
                this.userName = StorageUtil.load('userName') || '';
                this.apiKey = StorageUtil.load('geminiApiKey') || '';
                this.defaultPrompts = {
                    morning: ["á€’á€®á€™á€”á€€á€ºá€á€„á€ºá€¸á€™á€¾á€¬ á€˜á€šá€ºá€¡á€›á€¬á€€ á€á€„á€·á€ºá€€á€­á€¯ á€¡á€¬á€¸á€¡á€•á€¼á€Šá€·á€ºá€†á€¯á€¶á€¸á€–á€¼á€…á€ºá€…á€±á€á€œá€²á‹", "á€’á€®á€”á€±á€·á€€á€­á€¯ á€¡á€€á€±á€¬á€„á€ºá€¸á€†á€¯á€¶á€¸á€”á€±á€·á€á€…á€ºá€”á€±á€· á€–á€¼á€…á€ºá€…á€±á€–á€­á€¯á€· á€˜á€šá€ºá€œá€­á€¯á€›á€Šá€ºá€›á€½á€šá€ºá€á€»á€€á€ºá€™á€»á€­á€¯á€¸ á€‘á€¬á€¸á€›á€¾á€­á€‘á€¬á€¸á€•á€«á€á€œá€²á‹", "á€á€„á€·á€ºá€€á€­á€¯á€šá€ºá€á€„á€º á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€¡á€±á€¬á€„á€º á€’á€®á€”á€±á€· á€˜á€¬á€œá€¯á€•á€ºá€•á€±á€¸á€–á€­á€¯á€· á€…á€‰á€ºá€¸á€…á€¬á€¸á€‘á€¬á€¸á€•á€«á€á€œá€²á‹"],
                    night: ["á€’á€®á€”á€±á€· á€á€„á€ºá€šá€°á€œá€­á€¯á€€á€ºá€›á€á€²á€· á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€†á€¯á€¶á€¸á€¡á€›á€¬á€€ á€˜á€¬á€–á€¼á€…á€ºá€™á€œá€²á‹", "á€˜á€šá€ºá€¡á€–á€¼á€…á€ºá€¡á€•á€»á€€á€ºá€€ á€á€„á€·á€ºá€€á€­á€¯ á€•á€¼á€¯á€¶á€¸á€•á€»á€±á€¬á€ºá€…á€±á€á€²á€·á€•á€«á€á€œá€²á‹", "á€’á€®á€”á€±á€·á€¡á€á€½á€€á€º á€…á€­á€á€ºá€‘á€²á€€á€”á€± á€‘á€¯á€á€ºá€á€»á€•á€…á€ºá€á€»á€„á€ºá€á€²á€· á€¡á€›á€¬á€á€…á€ºá€á€¯á€á€¯ á€›á€¾á€­á€•á€«á€á€œá€¬á€¸á‹"],
                    gratitude: ["á€šá€”á€±á€· á€á€„á€ºá€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€™á€­á€á€²á€· á€œá€°á€•á€¯á€‚á€¹á€‚á€­á€¯á€œá€ºá€á€…á€ºá€¦á€¸á€€ á€˜á€šá€ºá€á€°á€œá€²áŠ á€˜á€¬á€€á€¼á€±á€¬á€„á€·á€ºá€œá€²á‹", "á€á€„á€·á€ºá€˜á€á€™á€¾á€¬ á€œá€€á€ºá€›á€¾á€­á€•á€­á€¯á€„á€ºá€†á€­á€¯á€„á€ºá€‘á€¬á€¸á€á€²á€·á€¡á€›á€¬á€á€½á€±á€‘á€²á€€ á€˜á€¬á€á€½á€±á€¡á€á€½á€€á€º á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€™á€­á€•á€«á€á€œá€²á‹", "á€šá€”á€±á€· á€á€„á€·á€ºá€€á€­á€¯ á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€…á€±á€á€²á€·á€á€²á€· á€á€±á€¸á€„á€šá€ºá€á€²á€·á€¡á€›á€¬á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€±á€¬á€ºá€•á€¼á€•á€«á‹"],
                    general: ["á€¡á€á€¯á€¡á€á€»á€­á€”á€ºá€™á€¾á€¬ á€á€„á€·á€ºá€…á€­á€á€ºá€‘á€²á€™á€¾á€¬ á€˜á€šá€ºá€œá€­á€¯á€á€¶á€…á€¬á€¸á€”á€±á€›á€•á€«á€á€œá€²á‹", "á€¡á€²á€·á€’á€®á€á€¶á€…á€¬á€¸á€á€»á€€á€ºá€€á€­á€¯ á€–á€¼á€…á€ºá€…á€±á€á€²á€· á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€›á€„á€ºá€¸á€€ á€˜á€¬á€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€™á€œá€²á‹", "á€á€„á€·á€ºá€¡á€á€½á€€á€º á€˜á€¬á€œá€¯á€•á€ºá€•á€±á€¸á€›á€„á€º á€…á€­á€á€ºá€á€€á€ºá€á€¬á€›á€¬á€›á€”á€­á€¯á€„á€ºá€™á€œá€²á€†á€­á€¯á€á€¬ á€•á€¼á€±á€¬á€•á€¼á€•á€±á€¸á€•á€«á‹"]
                };
                this.resetPromptState();
                this.init();
            }

            init() { this.showJournalSection(); }
            resetPromptState() { this.currentPromptIndex = 0; this.promptAnswers = []; this.activePrompts = []; }

            showJournalSection() {
                UIUtil.render('journalSection', templates.journalSection);
                UIUtil.showSection('journalSection');
                document.getElementById('journalDate').valueAsDate = new Date();
                this.bindMainButtons();
            }

            bindMainButtons() {
                document.getElementById('settingsBtn').onclick = () => this.showSettings(); // Assuming you have a settings template
                document.getElementById('startMorningBtn').onclick = () => this.startJournalingSession('morning');
                document.getElementById('startNightBtn').onclick = () => this.startJournalingSession('night');
                document.getElementById('startGratitudeBtn').onclick = () => this.startJournalingSession('gratitude');
                document.getElementById('startGeneralBtn').onclick = () => this.startJournalingSession('general');
                document.getElementById('myJournalBtn').onclick = () => this.renderJournalHistory(); // Assuming you have history template
                
                const moodOptions = document.querySelectorAll('.mood-option');
                const selectedMoodInput = document.getElementById('selectedMood');
                moodOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        moodOptions.forEach(opt => opt.classList.remove('active'));
                        option.classList.add('active');
                        selectedMoodInput.value = option.dataset.value;
                    });
                });
            }

            async startJournalingSession(mode) {
                if (this.isLoading) return;
                this.journalMode = mode;
                const mood = document.getElementById('selectedMood').value;
                if (this.journalMode === 'general' && !mood) {
                    UIUtil.showToast('á€›á€„á€ºá€–á€½á€„á€·á€ºá€á€¼á€„á€ºá€¸á€¡á€á€½á€€á€º á€œá€€á€ºá€›á€¾á€­á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯á€€á€­á€¯ á€›á€½á€±á€¸á€•á€±á€¸á€•á€«á‹', 'warning');
                    return;
                }
                // NOTE: Add API Key check here if needed.
                
                this.isLoading = true; this.resetPromptState();
                const btn = document.querySelector(`#start${mode.charAt(0).toUpperCase() + mode.slice(1)}Btn`);
                const originalText = btn.innerHTML;
                UIUtil.setLoading(btn, true, 'á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸ á€•á€¼á€„á€ºá€†á€„á€ºá€”á€±á€á€Šá€º');
                
                // Using default prompts directly as requested.
                this.activePrompts = this.defaultPrompts[this.journalMode];
                this.promptAnswers = Array(this.activePrompts.length).fill('');
                
                this.isLoading = false;
                UIUtil.setLoading(btn, false, originalText);
                
                UIUtil.render('promptsSection', templates.promptsSection);
                document.getElementById('prompt-title').textContent = btn.textContent;
                this.displayCurrentPrompt();
                UIUtil.showSection('promptsSection');
                this.bindPromptButtons();
            }

            bindPromptButtons() {
                document.getElementById('prevPromptBtn').onclick = () => this.navigatePrompt(-1);
                document.getElementById('nextPromptBtn').onclick = () => this.navigatePrompt(1);
                document.getElementById('combineAnswersBtn').onclick = () => this.combineAnswers();
                document.getElementById('backToMainFromPromptsBtn').onclick = () => this.showJournalSection();
            }

            displayCurrentPrompt() {
                // Update progress bar
                const progressBar = document.getElementById('progressBar');
                const progress = ((this.currentPromptIndex + 1) / this.activePrompts.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', progress);

                // Display prompt and answer
                document.getElementById('currentPromptText').textContent = this.activePrompts[this.currentPromptIndex];
                document.getElementById('promptAnswerTextarea').value = this.promptAnswers[this.currentPromptIndex] || '';
                document.getElementById('promptAnswerTextarea').focus();
                
                // Update counter and buttons
                document.getElementById('promptCounter').textContent = `${this.currentPromptIndex + 1} / ${this.activePrompts.length}`;
                document.getElementById('prevPromptBtn').disabled = (this.currentPromptIndex === 0);
                const isLast = this.currentPromptIndex === this.activePrompts.length - 1;
                document.getElementById('nextPromptBtn').classList.toggle('hidden', isLast);
                document.getElementById('combineAnswersBtn').classList.toggle('hidden', !isLast);
            }

            navigatePrompt(direction) {
                // Save current answer before moving
                this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value.trim();
                const newIndex = this.currentPromptIndex + direction;
                if (newIndex >= 0 && newIndex < this.activePrompts.length) {
                    this.currentPromptIndex = newIndex;
                    this.displayCurrentPrompt();
                }
            }
            
            async combineAnswers() {
                if (this.isLoading) return;
                // Save the final answer
                this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value.trim();

                if (this.promptAnswers.every(answer => answer === '')) {
                    UIUtil.showToast('á€¡á€€á€¼á€¶á€‰á€¬á€á€ºá€›á€šá€°á€›á€”á€º á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ á€™á€±á€¸á€á€½á€”á€ºá€¸á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€¼á€±á€†á€­á€¯á€•á€±á€¸á€•á€«á‹', 'warning');
                    return;
                }

                this.isLoading = true;
                const combineBtn = document.getElementById('combineAnswersBtn');
                UIUtil.setLoading(combineBtn, true, 'á€á€¯á€¶á€¸á€á€•á€ºá€”á€±á€á€Šá€º');
                UIUtil.showToast('AI á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º á€›á€šá€°á€”á€±á€•á€«á€á€Šá€ºá‹ á€á€±á€á€¹á€á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€•á€±á€¸á€•á€«á‹');

                const date = document.getElementById('journalDate').value;
                const mood = document.getElementById('selectedMood').value || 'á€™á€á€á€ºá€™á€¾á€á€ºá€‘á€¬á€¸';
                const time = new Date().toLocaleTimeString('en-GB');

                const combinedAnswers = this.promptAnswers.map((answer, i) => 
                    answer ? `á€™á€±á€¸á€á€½á€”á€ºá€¸ ${i + 1}: ${this.activePrompts[i]}\ná€¡á€–á€¼á€±: ${answer}` : ''
                ).filter(Boolean).join('\n\n---\n\n');
                
                const fullJournalText = `á€›á€€á€ºá€…á€½á€²: ${date}\ná€¡á€á€»á€­á€”á€º: ${time}\ná€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯: ${mood}\n\n---\n\n${combinedAnswers}`;
                
                UIUtil.render('analysisSection', templates.analysisSection);
                document.getElementById('combinedJournalText').value = fullJournalText;
                
                // Fetch AI advice
                const advice = await GeminiAPI.fetchCounselorAdvice(combinedAnswers, mood, this.journalMode, this.apiKey);
                document.getElementById('aiSuggestionDisplay').textContent = advice || "AI á€”á€¾á€„á€·á€ºá€á€»á€­á€á€ºá€†á€€á€ºáá€™á€›á€•á€«";
                
                // Save to local storage
                const newEntry = { date, time, mood, mode: this.journalMode, text: fullJournalText, aiSuggestion: advice };
                this.journalEntries.push(newEntry);
                StorageUtil.save('journalEntries', this.journalEntries);
                
                this.isLoading = false;
                UIUtil.showSection('analysisSection');
                document.getElementById('copyCombinedTextBtn').onclick = () => navigator.clipboard.writeText(fullJournalText).then(() => UIUtil.showToast('á€™á€¾á€á€ºá€á€™á€ºá€¸á€€á€­á€¯ á€€á€°á€¸á€šá€°á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹', 'success'));
                document.getElementById('backToMainJournalBtn').onclick = () => this.showJournalSection();
            }

            // --- Other methods like renderJournalHistory, showSettings would go here ---
        }

        // --- Start the App ---
        document.addEventListener('DOMContentLoaded', () => {
            new JournalApp();
        });
    </script>
</body>
</html>
