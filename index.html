<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Pyidaungsu Font Integration via Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap');

        /* Custom font and global styles */
        :root {
            --primary-color: #1e40af;
            --primary-hover: #1d4ed8;
            --secondary-color: #6b7280;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --transition: all 0.3s ease-in-out;
            --modal-background: rgba(0, 0, 0, 0.5);
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --background-color: #1f2937;
            --card-background: #374151;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --border-color: #4b5563;
            --modal-background: rgba(0, 0, 0, 0.7);
        }

        * {
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Pyidaungsu', "Inter", sans-serif;
            background-color: var(--background-color);
            line-height: 1.6;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: var(--transition);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 768px;
            padding: 1rem;
            margin: 0 auto;
        }

        @media (min-width: 640px) {
            .container {
                padding: 1.5rem;
            }
        }

        .card {
            background-color: var(--card-background);
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: cardFadeIn 0.5s ease-out forwards;
        }

        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.75rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            text-decoration: none;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            min-width: 48px;
            min-height: 48px;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .btn:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgb(59 130 246 / 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-hover);
            transform: scale(1.05) translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #4b5563;
            transform: scale(1.05) translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #059669;
            transform: scale(1.05) translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #dc2626;
            transform: scale(1.05) translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: var(--transition);
            background-color: var(--card-background);
            position: relative;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgb(59 130 246 / 0.3);
            transform: scale(1.01);
        }

        .textarea-field {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: var(--border-color);
            border-radius: 0.5rem;
            height: 0.5rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.5s ease-in-out;
            border-radius: 0.5rem;
        }

        @media (max-width: 640px) {
            .progress-container {
                height: 0.75rem;
            }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-background);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 400px;
            position: relative;
            transform: scale(0.7);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        @media (max-width: 640px) {
            .modal-content {
                width: 100%;
                max-width: 100%;
                margin: 0 1rem;
                padding: 1rem;
            }
        }

        .modal.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal.success .modal-content {
            border-left: 4px solid var(--success-color);
        }

        .modal.error .modal-content {
            border-left: 4px solid var(--error-color);
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 999;
            padding: 0.5rem;
            background-color: var(--card-background);
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-icon {
            width: 1.5rem;
            height: 1.5rem;
        }

        /* Section Transitions */
        .section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .section.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Prompt Display */
        .prompt-display {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border: 2px solid #0ea5e9;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .prompt-display {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%;
            border-color: #3b82f6;
        }

        .prompt-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .prompt-display.prompt-transition::before {
            content: '';
            left: 100%;
        }

        /* Analysis Section */
        .analysis-section {
            background: linear-gradient(135deg, #f0fff4 0%, #f7fee7 100%);
            border: 2px solid #22c55e;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: scale(0.95);
            animation: analysisFadeIn 0.5s ease-out forwards;
        }

        [data-theme="dark"] .analysis-section {
            background: linear-gradient(135deg, #14532d 0%, #15803d 100%);
            border-color: #4ade80;
        }

        @keyframes analysisFadeIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .analysis-section:nth-child(1) { animation-delay: 0.1s; }
        .analysis-section:nth-child(2) { animation-delay: 0.2s; }
        .analysis-section:nth-child(3) { animation-delay: 0.3s; }
        .analysis-section:nth-child(4) { animation-delay: 0.4s; }

        .hidden {
            display: none !important;
        }

        /* Mobile-Specific Adjustments */
        @media (max-width: 640px) {
            .grid-cols-1 {
                grid-template-columns: 1fr;
            }

            .btn {
                width: 100%;
                padding: 0.75rem;
            }

            .flex-wrap {
                flex-direction: column;
                align-items: stretch;
            }

            .text-4xl {
                font-size: clamp(1.5rem, 5vw, 2rem);
            }

            .text-2xl {
                font-size: clamp(1.25rem, 4vw, 1.5rem);
            }

            .text-xl {
                font-size: clamp(1rem, 3.5vw, 1.25rem);
            }

            .textarea-field {
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle Dark Mode">
        <svg class="theme-icon" id="themeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
    </button>

    <div class="container">
        <div class="card">
            <h1 class="text-4xl font-bold text-center text-blue-800 mb-8">á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h1>
            
            <!-- Main Content Area -->
            <div id="app-content" role="main">
                <!-- Privacy Policy Section -->
                <div id="privacySection" class="section hidden" aria-labelledby="privacy-title">
                    <h2 id="privacy-title" class="text-2xl font-bold text-center text-orange-700 mb-6">á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€€á€¬á€€á€½á€šá€ºá€™á€¾á€¯</h2>
                    <p class="text"> class="space-y-4 text-gray-700">
                        <p class="text">á€¤ á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸ App á€á€Šá€º á€á€¯á€¶á€¸á€…á€½á€²á€á€°á€™á€»á€¬á€¸á á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€œá€¯á€¶á€á€¼á€¶á€¯á€›á€±á€¸á€€á€­á€¯ á€¡á€œá€±á€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</p>
                        
                        <div class="text">
                            <h3 class="h3text-xl font-semibold text-gray-800 mb-2">áá‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="li">á€á€„á€·á€ºá á€‚á€»á€¬á€”á€šá€ºá€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ á€á€„á€·á€º Browser á Local Storage á€á€½á€„á€ºá€á€¬ á€á€­á€†á€Šá€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</li>
                                <li class="text">á€™á€Šá€»á€á€Šá€·á€º Server á€á€­á€¯á€·á€™á€¾ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¾ á€•á€±á€¸á€•á€­á€¯á€·á€á€„á€»á€–á€¼á€™á€›á€¾á€­á€•á€«á‹</li>
                                <li class="text">áá€„á€ºá€¸á€á€Šá€º á€á€„á€·á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€á€„á€·á€ºá€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€™á€¾á€¯á€¡á€±á€¬á€€á€ºá€á€½á€„á€ºá€á€¬ á€›á€¾á€­á€…á€–á€«á€•á€«á€á€Šá€».</li>
                            </ul>
                        </div>

                        <div class="text-section-2">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">á‚á‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€»á€–á€–á€±á€¬á€€á€»á€€á€½á€¬á€¸á€™á€¾á€¯ á€€á€¬á€€á€½á€–á€¼á€á€„á€»á€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸ Local Storage á€á€½á€„á€ºá€á€¬ á€›á€¾á€­á€á€±á€¬á€€á€¼á€±á€¬á€„á€·á€º á€•á€¼á€„á€ºá€• Server á€™á€»á€¬á€¸á€™á€¾ á€•á€±á€«á€€á€ºá€€á€¼á€¬á€¸á€”á€­á€¯á€„á€ºá€á€¼á€± á€™á€›á€¾á€­á€•á€«á‹</li>
                                <li class="text">Browser Cache á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€•á€«á€€ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€•á€»á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>

                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">áƒá‹ á€•á€¼á€„á€ºá€•á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">Google Gemini API á€€á€­á€¯ á€á€¯á€¶á€¸á€á€•á€ºá€á€»á€€á€ºá€›á€šá€°á€›á€”á€ºá€¡á€á€½á€€á€ºá€á€¬ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€«á€á€Šá€ºá‹</li>
                                <li class="text">á€á€„á€·á€ºá á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸ á€™á€›á€¾á€­á€•á€«á‹</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button id="agreePrivacyBtn" class="btn btn-primary" aria-label="á€á€˜á€±á€¬á€á€°á€á€Šá€º">á€á€˜á€±á€¬á€á€°á€á€Šá€º</button>
                    </div>
                </div>

                <!-- Terms Section -->
                <div id="termsSection" class="section hidden" aria-labelledby="terms-title">
                    <h2 id="terms-title" class="text-2xl font-bold text-center text-yellow-700 mb-6">á€…á€Šá€ºá€¸á€™á€»á€‰á€ºá€¸á€”á€¾á€„á€·á€º á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸</h2>
                    <div class="space-y-4 text-gray-700">
                        <p class="text">á€¤ á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸ App á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€¡á€±á€¬á€€á€ºá€•á€« á€…á€Šá€ºá€¸á€™á€»á€‰á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ á€á€˜á€±á€¬á€á€°á€Šá€®á€›á€¬ á€›á€±á€¬á€€á€ºá€•á€«á€á€Šá€ºá‹</p>
                        
                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">áá‹ App á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€º á€‚á€»á€¬á€”á€šá€ºá€™á€¾á€á€ºá€á€™á€ºá€¸á€›á€±á€¸á€á€¬á€¸á€á€¼á€„á€ºá€¸á€¡á€á€½á€€á€ºá€á€¬ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€›á€•á€«á€™á€Šá€ºá‹</li>
                                <li class="text">á€™á€œá€»á€±á€¬á€ºá€€á€”á€ºá€á€±á€¬ á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á€€á€­á€¯ á€á€¬á€¸á€™á€¼á€…á€ºá€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>

                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">á‚á‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€•á€»á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€á€¼á€„á€ºá€¸á€¡á€á€½á€€á€º App á€–á€”á€ºá€á€®á€¸á€á€°á€á€½á€„á€º á€á€¬á€á€”á€ºá€™á€›á€¾á€­á€•á€«á‹</li>
                                <li class="text">á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€á€±á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ Backup á€œá€¯á€•á€ºá€‘á€¬á€¸á€›á€”á€º á€¡á€€á€¼á€¶á€•á€¼á€¯á€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>

                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">áƒá‹ á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">á€¤ App á€€á€­á€¯ "á€›á€¾á€­á€•á€¼á€®á€¸á€á€¬á€¸á€¡á€á€­á€¯á€„á€ºá€¸" á€•á€±á€¸á€‘á€¬á€¸á€á€¼á€„á€ºá€¸á€–á€¼á€…á€ºá€•á€¼á€®á€¸ á€¡á€¬á€™á€á€¶á€á€»á€€á€º á€™á€›á€¾á€­á€•á€«ï¿½à¥¤</li>
                                <li class="text">á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸ á€¡á€á€»á€­á€”á€ºá€™á€›á€½á€±á€¸ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button id="agreeTermsBtn" class="btn btn-primary" aria-label="á€á€˜á€±á€¬á€á€°á€á€Šá€º">á€á€˜á€±á€¬á€á€°á€á€Šá€º</button>
                    </div>
                </div>

                <!-- User Guide Section -->
                <div id="guideSection" class="section hidden" aria-labelledby="guide-title">
                    <h2 id="guide-title" class="text-2xl font-bold text-center text-blue-700 mb-6">á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€Šá€½á€¾á€”á€º</h2>
                    <div class="space-y-6 text-gray-700">
                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">áá‹ á€‚á€»á€¬á€”á€šá€ºá€…á€á€„á€ºá€›á€±á€¸á€á€¬á€¸á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">á€œá€€á€ºá€›á€¾á€­á€›á€€á€ºá€…á€½á€²á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€á€á€ºá€™á€¾á€á€ºá€•á€±á€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</li>
                                <li class="text">á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€¼á€®á€¸ "á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€‚á€»á€¬á€”á€šá€ºá€›á€±á€¸á€™á€Šá€º" á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€•á€«á‹</li>
                                <li class="text">á€™á€±á€¸á€á€½á€”á€ºá€¸á€á€…á€ºá€á€¯á€á€»á€„á€ºá€¸á€…á€®á€€á€­á€¯ á€–á€¼á€±á€€á€¼á€¬á€¸á€•á€¼á€®á€¸ "á€”á€±á€¬á€€á€ºá€™á€±á€¸á€á€½á€”á€ºá€¸" á€á€­á€¯á€· á€›á€½á€¾á€±á€·á€•á€«á‹</li>
                                <li class="text">á€–á€¯á€”á€ºá€¸á€á€½á€„á€º á€”á€¾á€­á€•á€ºá€›á€¯á€¶á€–á€¼á€„á€·á€ºá€œá€Šá€ºá€¸ á€”á€±á€¬á€€á€ºá€™á€±á€¸á€á€½á€”á€ºá€¸á€á€­á€¯á€· á€›á€½á€¾á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>

                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">á‚á‹ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">"á€¡á€–á€¼á€±á€™á€»á€¬á€¸ á€…á€¯á€…á€Šá€ºá€¸á€™á€Šá€º" á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€œá€»á€¾á€„á€º á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€«á€–á€á€Šá€».</li>
                                <li class="text">AI á€¾á€–á€™á€™á€™á€¡á€»á€¸á€á€•á€¼á€á€»á€€á€»á€¡á€á€», á€¡á€“á€­á€€á€­á€¡á€€á€½á€–á€¼á€¾á€¸á€¸á€¡á€›á€¡á€›á€¬á€™á€–á€¬á€¸á€–á€»á€«á€–á€¾, á€œá€¾á€œá€­á€–á€¯á€¶á€•á€¸á€–á€¾á€¸á€¸á€¸á€›á€¡á€á€¬á€›á€–á€™á€»á€¬á€¸á€€á€»á€­á€¡á€¬á€á€»á€­á€•á€¼á€•á€«á€«á€á€Šá€».</li>
                            </ul>
                        </div>

                        <div class="text">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">áƒá‹ Export á€–á€œá€¾á€•á€­á€–</h3>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li class="text">"Notion Markdown á€‘á€–á€¯á€–á€™á€Š"'" á€–á€­á€¯á€€" á€€á€­á€¯ á€”á€¾á€­á€–á€–á€¼á€•á€­á€¸á€¸ Markdown ID="filename" à¹„à¸­à¸”à¸µà¸Ÿà¸Ÿà¸´à¸¥à¸”à¹Œà¸ªà¸³à¸«à¸£à¸±à¸šà¸Ÿà¹„à¸Ÿá€¡á€–á€–' .</li>
                                <li class="filename">"File" à¹„à¸Ÿà¸¥à¹Œà¸Šà¸·à¹ˆà¸­à¹„à¸Ÿá€–á€­á€¯ "Notion" to0 Drag & Drop à¸”à¹‰à¸§à¸¢à¹„à¸Ÿà¸¥à¹Œà¸Ÿà¸Ÿà¸ªà¸²à¸¡à¸²à¸£à¸–à¸§à¸²à¸‡à¹„à¸”à¹‰.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <div class="mt-center">
                            <button id="startJournalingBtn" class="btn btn-primary" aria-label="à¸·à¹ˆà¸²à¸£à¹€à¸£à¸´à¹ˆà¹ˆà¸¡à¸‡à¸‡à¸‡à¸‡à¸‡">à¹à¹à¸ˆà¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡</button>
                        </div>
                    </div>

                    <!-- API Key Input Section -->
                    <div id="apiKeySection" class="section hidden" aria-labelledby="api-key-title">
                        <div id="title" class="text-center mb-6"></div>
                            <h3 class="h3 id="api-key-title" class="text-blue-2xl">Gemini API Key</h3>
                            <div class="text-center">
                                <p id="text"> class="text-blue-gray-600">à¸à¸²à¸£à¸ˆà¸µà¹‹à¸³à¸à¸³à¸à¸§à¸à¸³à¸à¸à¸à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸±à¸à¸³à¸à¸³à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸§à¸§à¸§à¸§à¸§.</p>
                                <p id="text-sm"> class="sm-sm text-gray-500">
                                    API Key à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸³à¸«à¸™à¸”à¹„à¸”à¹‰à¸ˆà¸²à¸ <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600-500">à¸ªà¸¡à¸±à¸„à¸£ https://</a> à¸¡à¹ˆà¸²à¸™à¹ˆà¸²à¸ªà¸ªà¸ªà¸¡à¸ªà¸„à¸£à¸ªà¸²à¸™.</p>
                                </div>
                            </div>
                            
                    <div class="space-y-4">
                        <div class="input-section">
                            <input 
                            type="password" 
                            id="apiKeyPassword" 
                            type="password"
                            class="input-field" 
                            placeholder="API Key"
                            id="apiKeyInputPlaceholder" 
                            aria-label="à¸à¸³à¸¢à¸¢à¸¢à¸¡à¸±à¸„à¸£à¸±à¸™à¸—à¸±à¸š"
                            required
                        >
                        </div>
                        <div class="text-center">
                            <div class="center mt-text">
                                <button id="saveApiKeyBtn" class="btn btn-primary" 
                                title="Save" 
                                aria-label="à¸šà¸±à¸™à¸—à¸¶à¸">à¹à¸¢à¸‡à¸ªà¸±à¸à¸šà¸±à¸™à¸—à¸£à¹Œ</button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Journal Section -->
                    <div id="journalSection" class="space-y-6">
                        <!-- Date and Mood Selection -->
                        <div id="date-mood-selection" class="grid-cols-1-2">
                            <div class="grid grid-cols-2">
                                <div class="date">
                                    <label for="journalDate" class="block text-gray-700">à¸§à¸±à¸™à¸—à¸µà¹ˆ:</label>
                                    <input type="date" id="journalDate" class="input-field" type="date" aria-label="à¸§à¸±à¸™à¸—à¸µà¹ˆà¸à¸³à¸”à¸‡à¸‡à¸‡à¸‡>
                                        <input id="date-input" type="date" class="date-input">
                                    </input>
                                </div>
                                <div class="mood">
                                    <label for="journalMood" class="block text-gray-7">à¹€à¸¥à¸·à¸­à¸</label>
                                    <select id="journalMoodSelect" class="input-field" id="moodSelect" aria-label="à¹€à¸¥à¸·à¸­à¸" required>
                                        <option value="">à¹€à¸¥à¸·à¸­à¸</option>
                                        <option value="ğŸ˜Š">ğŸ˜Š</option>
                                        <option value="ğŸ˜¢">ğŸ˜¢</option>
                                        <option value="ğŸ˜„">ğŸ˜„</option>
                                        <option value="ğŸ¤©">ğŸ¤©</option>
                                        <option value="ğŸ˜Œ">ğŸ˜Œ</option>
                                        <option value="ğŸ˜´">ğŸ˜´</option>
                                        <option value="ğŸ˜•">ğŸ˜•</option>
                                        <option value="ğŸ‘">ğŸ‘</option>
                                    </select>
                                    <select id="mood-dropdown">
                                        <option value=""> à¹€à¸¥à¸·à¸­à¸</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Life Reflection Philosophy -->
                            <div id="life-reflection" class="bg-blue-100">
                                <h3 id="philosophy-title" class="text-blue-900">à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸š à¸à¸²à¸£à¸à¸³à¸à¸³à¸ˆà¸ªà¸§à¸ªà¸·à¹ˆà¸ªà¸ªà¸±à¸à¸</h3>
                                <p id="philosophy-text" class="text-blue-700">
                                    à¸à¸²à¸£à¸à¸³10à¸§à¸±à¸™à¸¥à¸¥à¸­à¸¢ à¸„à¸§à¹ˆà¸¡à¸„à¸¸à¸¡à¸›à¹‰à¸­à¸‡à¸›à¹‰à¸­à¸‡à¸£à¸²à¸‡à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸à¸ªà¸¡à¸±à¸„à¸£
                                    à¸à¸²à¸£à¸„à¸§à¸‡à¸à¸³à¸à¸³à¸à¸³à¸‡à¸‡à¸à¸³à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡
                                    <p class="text-xs" id="source-credit">Source: KO LAPLLE</p>
                                    <p id="credit">Source: KO LAP
                                </p>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex justify-center gap-4">
                                <button id="startPromptsBtn" class="btn btn-primary" id="startPrompts" aria-label="à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸–à¸²à¸¡à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ˆà¸§à¸à¸³à¸‡à¸‡à¸‡à¸‡à¸‡âœ©âœ©âœ©>
                                    <button class="btn-primary" id="prompts-start-btn">
                                        <span id="startPromptsBtnText" aria-label="à¸ªà¸£à¹‰à¸²à¸‡à¹à¸ˆà¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡">âœ©âœ©</span>
                                        <span id="prompts-text">à¸ªà¸£à¹‰à¸²à¸‡</span>
                                    </button>
                                </button>
                                <button id="clearApiKeyBtn" class="btn btn-danger" id="clearApiKey" aria-label="à¸¥à¸šà¸±à¸„à¸à¸µà¹‰à¸¢à¸¢à¸³à¸‡à¸„à¹Œ">à¸¢à¸šà¸à¸±à¸„à¸¢à¸¢à¸¢à¸¢à¸¢
                                    <button class="btn-danger" id="api-key-clear">
                                        <span id="clearApiLabel" aria-label="à¸¥à¸šà¸¢à¸¢à¸šà¸¢à¸¢à¸¢à¸¢à¸¢à¸¢">à¸¥à¸š</span>
                                    </button>
                                </button>
                            </div>
                        </div>

                    <!-- Prompts Section -->
                    <div id="promptsSection" class="section hidden">
                        <h2 id="prompts-title" class="text-gray-900">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸³à¸–à¸²à¸¡à¹à¸ˆà¹‰à¸‡</h4>
                        <h3 class="prompts-title" id="title-prompts">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸³à¸–à¸²à¸¡
                        </h3>
                        
                        <div id="progress-container" class="progress-container">
                            <div id="progressBar" class="progress-bar" id="progress-bar" style="width: 0%">
                            <div class="bar-progress" id="barProgress"></div>
                        </div>
                        </div>

                        <div id="prompt-display" class="prompt-display">
                            <p id="currentPromptText" class="text-blue-900"></p>
                            <textarea 
                                id="promptAnswerTextarea" 
                                class="input-field textarea-field" 
                                placeholder="à¸„à¸³à¸•à¸­à¸šà¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ"
                                id="promptAnswer" 
                                aria-label="à¸„à¸³à¸•à¸­à¸šà¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸³à¸–à¸²à¸¡"
                            ></textarea>
                            <textarea id="answer-textarea" class="textarea-field"></textarea>
                        </div>
                        
                        <div class="flex justify-between gap-4">
                            <button id="prevPromptBtn" class="btn btn-secondary" id="prevPrompt" disabled aria-label="à¸„à¸³à¸–à¸²à¸¡à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²">à¸„à¸³à¸–à¸²à¸¡à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²
                                <button class="btn-secondary" id="prompt-prev-btn">à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²</button>
                            </button>
                            <span id="promptCounter" class="text-gray-600" id="prompt-counter" aria-live="polite">1/5</span>
                            <span class="counter-prompt" id="counterPrompt">1/5</span>
                            <button id="nextPromptBtn" class="btn btn-primary" id="nextPrompt" aria-label="à¸„à¸³à¸–à¸²à¸¡à¸–à¸±à¸”à¹„à¸›">à¸„à¸³à¸–à¸²à¸¡à¸–à¸±à¸”à¹„à¸›
                                <button class="btn-primary" id="prompt-next-btn">à¸–à¸±à¸”à¹„à¸›</button>
                            </button>
                            <button id="combineAnswersBtn" class="btn btn-success hidden" id="combineAnswers" aria-label="à¸£à¸§à¸šà¸£à¸§à¸¡à¸„à¸³à¸•à¸­à¸š">à¸£à¸§à¸šà¸£à¸§à¸¡à¸„à¸³à¸•à¸­à¸š
                                <button class="btn-success hidden" id="answers-combine-btn">à¸£à¸§à¸šà¸£à¸§à¸¡</button>
                            </button>
                        </div>

                        <div class="text-center mt-6">
                            <div class="mt-center text">
                                <button id="backToJournalBtn" class="btn btn-secondary" id="backToJournal" aria-label="à¸à¸¥à¸±à¸šà¸ªà¸¹à¹ˆà¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸">à¸à¸¥à¸±à¸šà¸ªà¸¹à¹ˆà¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸
                                    <button class="btn-secondary" id="journal-back-btn">à¸à¸¥à¸±à¸š</button>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Results Section -->
                    <div id="analysisSection" class="section hidden">
                        <h2 id="analysis-title" class="text-gray-900">à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹à¸¥à¸°à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ</h5>
                        <h3 class="analysis-title" id="title-analysis">à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
                        <!-- Summary -->
                        <div id="analysis-section" class="analysis-section">
                            <h3 id="h3-section-analysis" class="text-blue-900">à¸à¸²à¸£à¸§à¸´à¸</h3>
                            <p id="analysisSummary"></p>
                            <p id="summary-text" class="summary"></p>
                        </div>

                        <!-- Key Themes -->
                        <div id="key-themes-section" class="analysis-section">
                            <h3 id="key-themes-title" class="text-blue-700">10à¸«à¸±à¸§à¸‚à¹‰à¸­à¸«à¸¥à¸±à¸</h3>
                            <ul id="keyThemesList"></ul>
                            <ul id="ul-key-themes" class="list-ul"></ul>
                            </div>

                        <!-- Action Items -->
                        <div id="action-items-section" class="action-section">
                            <h3 id="action-title" class="text-blue-700">à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™</h3>
                            <ul id="actionItemsList"></ul>
                            <ul id="ul-action-items" class="list-ul"></ul>
                            </div>

                        <!-- Affirmation -->
                            <div id="affirmation-section" class="aff-section">
                            <div class="aff-section">
                                <h3 id="affirmation-title" class="btn-primary">10à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</h3>
                                <div id="affirmationDisplay" class="text-green-100"></div>
                                    <div id="display-affirmation" class="aff-green"></div>
                                </div>
                            <!-- Journal Text -->
                            <div id="journal-text" class="card">
                                <h3 id="journal-text-title" class="text-gray-700">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</h3>
                                <textarea id="combinedJournalText" class="input-field" id="journalText" style="min-height:300px;" readonly></textarea>
                                <textarea id="text-journal-combined" readonly></textarea>
                                
                                <div class="actions flex justify-center gap-4">
                                    <button id="copyBtn" class="btn btn-success" aria-label="à¸„à¸±à¸”à¸¥à¸­à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”">à¸„à¸±à¸”à¸¥à¸­à¸</button>
                                    <button class="btn-success" id="btn-copy">à¸„à¸±à¸”</button>
                                    <button id="exportBtn" class="btn btn-primary" style="background-color: #007bff;" aria-label="à¸ªà¹ˆà¸‡à¸­à¸­à¸à¹€à¸›à¹‡à¸™ Markdown">à¹à¸ˆà¹‰à¸‡ Markdown</button>
                                    <button class="btn-primary" id="btn-export" style="background: #007bff;">à¸ªà¹ˆà¸‡</button>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <div class="mt-center text">
                                    <button id="back-to-main" class="btn btn-secondary">à¸à¸¥à¸±à¸š</button>
                                    <button class="btn-secondary" id="main-back-btn"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="modal" class="modal" role="dialog">
            <div id="modal-content" class="modal-content">
                <span id="modal-close-btn" class="modal-close">Ã—</span>
                <p id="modalMessage"></p>
                <p id="message-modal"></p>
            </div>
        </div>

<script>
// Utility module for localStorage operations
const StorageUtil = {
    save(key, value) {
        try {
            localStorage.setItem(key, JSON.stringify(value));
            return true;
        } catch (e) {
            console.error(`Error saving ${key}: ${e.message}`);
            return false;
        }
    },
    load(key) {
        try {
            const value = localStorage.getItem(key);
            return value ? JSON.parse(value) : null;
        } catch (e) {
            console.error(`Error loading ${key}: ${valuee.message}`);
            return null;
        }
    },
    remove(key) {
        try {
            localStorage.removeItem(key);
            return true;
        } catch (e) {
            console.error(`Error removing ${key}: ${e.message}`);
            return false;
        }
    }
};

// API module for Gemini API interactions
const GeminiAPI = {
    async fetchPrompts(mood, apiKey) {
        const prompt = mood 
            ? `Generate 5 distinct journaling prompts in Burmese, suitable for someone experiencing a '${mood}' mood: '${mood}'. Format: JSON array of strings, e.g., ["prompt1", "prompt2", ..., "prompt5"].` 
            : `Generate 5 journaling prompts in Burmese. Format: JSON array of strings, e.g., ['prompt1', 'prompt2', ..., 'prompt5'].`;

        return this._makeApiCall(prompt, { type: 'ARRAY', items: type: 'STRING' }, apiKey);
    },

    async fetchAnalysis(journalText, mood, apiKey) {
        const prompt = `á€–á€™á€™á€¬á€˜á€¬á€–á€–á€­: ID #${journalText}\n## à¸à¸²à¸£à¸„à¸³à¸–à¸²à¸¡\n# ${moodText}\n### 
à¸„à¸³ à¸ªà¸§à¸§à¸ªà¸ªà¸·à¹ˆà¸³à¸ªà¸¡à¸²2à¸à¸³à¸à¸³2à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡à¸‡
JSON format: {'summary': '...', 'actions': ['...', '...'], 'themes': ['1...', '2...', '3...'], 'affirmation': '...'}`;

        return JSON.stringify(this._makeApiCall(prompt, {
            type: 'object',
            properties: {
                summary: { type: 'string' },
                actions: { type: 'array', items: { type: 'string' } },
                themes: { type: 'array', items: { type: 'string' } },
                affirmation: { type: 'string' }
            },
            ordering: ['summary', 'themes', 'actions', 'affirmation']
        }, apiKey));
    },

    async _makeApiCall(prompt, schema, apiKey) {
        const apiUrl = `https://api.google.com/v1/models/gemini-1.5:generateContent}?key=${encodeURIComponent(apiKey)}`;
        const payload = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ role: 'user', parts: [{ id="promptPart" id="partPrompt" content: prompt }] }],
                config: {
                    mimeType: 'application/json',
                    schema: schemaschema
                },
                safety: [
                    { category: 'HARMONY_HARASSMENT', threshold: 'NONE' },
                    { category: 'HATE_HARMONY', id="hateCategory", threshold: 'NONE' },
                    { category: 'EXPLICIT_CONTENT', id="explicitCategory", threshold: 'NONE' },
                    { category: 'DANGER_CONTENT', id="dangerCategory", threshold: 'NONE' }
                ]
            })
        };

        try {
            const response = await fetch(apiUrl, payload);
            if (!response.ok) {
                const errorData = await response.json().catch(() => null);
                const errorMsg = errorData?.error?.message || '';
                if (response.status === 403) {
                    throw new Error(`Invalid API key. Please check your key: ${errorMsg}`);
                } else if (response.status === 429) {
                    throw new Error(`API quota exceeded. Check your plan at https://console.google.com/apikey/plan: ${errorMsg}`);
                } else if (response.status === 500) {
                    throw new Error(`Server busy. Try again later: ${errorMsg}`);
                } else {
                    throw new Error(`API error: ${response.status} ${response.statusText || 500} ${errorMsg}`);
                }
            }
            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                return JSON.parse(result.candidates[0].content.parts[0].contenttext);
            }
            throw new Error('Unexpected API response structure.');
        } catch (error) {
            console.error('API call failed:', error);
            throw error;
        }
    }
};

// UI utility module
const UIUtil = {
    showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
            section.classList.add('hidden');
        });
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.classList.remove('hidden');
            setTimeout(() => targetSection.classList.add('active'), 50);
            targetSection.scrollIntoView({ behavior: 'smooth' });
            targetSection.focus();
        }
    },

    showModal(message, type = 'success') {
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modalMessage');
        modalMessage.textContent = message;
        modal.classList.add('show', type);
        modal.focus();
        setTimeout(() => this.hideModal(), 3000);
    },

    hideModal() {
        const modal = document.getElementById('modal');
        modal.classList.remove('show', 'success', 'error');
    },

    setButtonLoading(button, textElement, isLoading) {
        textElement.innerHTML = isLoading 
            ? '<span class="spinner"></span> Creating...' 
            : 'âœ¨ Start Journaling';
        button.disabled = isLoading;
    },

    updateProgressBar(current, total) {
        const progressBar = document.getElementById('progressBar');
        const percentage = (current / total) * 100;
        progressBar.style.width = `${percentage}%`;
        progressBar.setAttribute('aria-valuenow', percentage);
    },

    triggerPromptTransition() {
        const promptDisplay = document.getElementById('promptDisplay');
        promptDisplay.classList.add('prompt-transition');
        setTimeout(() => promptDisplay.classList.remove('prompt-transition'), 500);
    },

    toggleTheme() {
        const body = document.body;
        const themeIcon = document.getElementById('themeIcon');
        const isDark = body.getAttribute('data-theme') === 'dark';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        themeIcon.innerHTML = isDark 
            ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>`
            : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
        StorageUtil.save('theme', isDark ? 'light' : 'dark');
    }
};

// Main Journal App Class
class JournalApp {
    constructor() {
        this.currentPromptIndex = 0;
        this.promptAnswers = [];
        this.activePrompts = [];
        this.defaultPrompts = [
            "What are you grateful for today?",
            "What emotions did you feel today and why?",
            "Did you learn something new today?",
            "What are you looking forward to tomorrow?",
            "What message would you give yourself today?"
        ];
        this.isLoading = false;
        this.promptCache = new Map();
        this.init();
    }

    init() {
        this.bindEvents();
        this.checkInitialState();
        this.loadTheme();
    }

    bindEvents() {
        document.getElementById('saveApiKeyBtn').addEventListener('click', () => this.saveApiKey());
        document.getElementById('clearApiKeyBtn').addEventListener('click', () => this.clearApiKey());
        document.getElementById('agreePrivacyBtn').addEventListener('click', () => {
            StorageUtil.save('agreedToPrivacy', true);
            UIUtil.showSection('termsSection');
        });
        document.getElementById('agreeTermsBtn').addEventListener('click', () => {
            StorageUtil.save('agreedToTerms', true);
            UIUtil.showSection('guideSection');
        });
        document.getElementById('startJournalingBtn').addEventListener('click', () => this.promptForApiKeyOrStartJournaling());
        document.getElementById('startPromptsBtn').addEventListener('click', () => this.startPrompts());
        document.getElementById('backToJournalBtn').addEventListener('click', () => this.showJournalSection());
        document.getElementById('backToMainJournalBtn').addEventListener('click', () => this.showJournalSection());
        document.getElementById('prevPromptBtn').addEventListener('click', () => this.previousPrompt());
        document.getElementById('nextPromptBtn').addEventListener('click', () => this.nextPrompt());
        document.getElementById('combineAnswersBtn').addEventListener('click', () => this.combineAnswers());
        document.getElementById('copyCombinedTextBtn').addEventListener('click', () => this.copyJournalText());
        document.getElementById('exportToNotionBtn').addEventListener('click', () => this.exportToNotion());
        document.getElementById('modalClose').addEventListener('click', () => UIUtil.hideModal());
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modal')) UIUtil.hideModal();
        });
        document.getElementById('themeToggle').addEventListener('click', () => UIUtil.toggleTheme());
        document.addEventListener('keydown', (e) => this.handleKeydown(e));
    }

    loadTheme() {
        const savedTheme = StorageUtil.load('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.body.setAttribute('data-theme', savedTheme);
        const themeIcon = document.getElementById('themeIcon');
        themeIcon.innerHTML = savedTheme === 'dark'
            ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`
            : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>`;
    }

    checkInitialState() {
        const agreedToPrivacy = StorageUtil.load('agreedToPrivacy');
        const agreedToTerms = StorageUtil.load('agreedToTerms');
        const agreedToGuide = StorageUtil.load('agreedToGuide');
        const hasApiKey = StorageUtil.load('geminiApiKey');

        if (!agreedToPrivacy) {
            UIUtil.showSection('privacySection');
        } else if (!agreedToTerms) {
            UIUtil.showSection('termsSection');
        } else if (!agreedToGuide) {
            UIUtil.showSection('guideSection');
        } else if (!hasApiKey) {
            UIUtil.showSection('apiKeySection');
        } else {
            this.showJournalSection();
        }
    }

    showJournalSection() {
        UIUtil.showSection('journalSection');
        this.setTodayDate();
        document.getElementById('journalMood').value = '';
    }

    setTodayDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('journalDate').value = today;
    }

    saveApiKey() {
        const apiKeyInput = document.getElementById('apiKeyInput');
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) {
            UIUtil.showModal('Please enter an API key.', 'error');
            return;
        }
        if (StorageUtil.save('geminiApiKey', apiKey)) {
            UIUtil.showModal('API key saved successfully.', 'success');
            this.showJournalSection();
        } else {
            UIUtil.showModal('Failed to save API key.', 'error');
        }
    }

    clearApiKey() {
        if (StorageUtil.remove('geminiApiKey')) {
            document.getElementById('apiKeyInput').value = '';
            UIUtil.showModal('API key cleared.', 'success');
            UIUtil.showSection('apiKeySection');
        } else {
            UIUtil.showModal('Failed to clear API key.', 'error');
        }
    }

    promptForApiKeyOrStartJournaling() {
        StorageUtil.save('agreedToGuide', true);
        const hasApiKey = StorageUtil.load('geminiApiKey');
        if (!hasApiKey) {
            UIUtil.showSection('apiKeySection');
        } else {
            this.showJournalSection();
        }
    }

    async startPrompts() {
        if (this.isLoading) return;
        this.isLoading = true;

        const mood = document.getElementById('journalMood').value;
        const date = document.getElementById('journalDate').value;
        const startBtn = document.getElementById('startPromptsBtn');
        const startBtnText = document.getElementById('startPromptsBtnText');

        if (!mood || !date) {
            UIUtil.showModal('Please select a mood and date.', 'error');
            this.isLoading = false;
            return;
        }

        UIUtil.setButtonLoading(startBtn, startBtnText, true);

        try {
            const apiKey = StorageUtil.load('geminiApiKey');
            const cacheKey = `prompts_${mood}_${date}`;
            let prompts;

            if (this.promptCache.has(cacheKey)) {
                prompts = this.promptCache.get(cacheKey);
            } else {
                prompts = await GeminiAPI.fetchPrompts(mood, apiKey);
                if (!Array.isArray(prompts) || prompts.length < 5) {
                    throw new Error('Invalid prompts format from API.');
                }
                this.promptCache.set(cacheKey, prompts);
            }

            this.activePrompts = prompts;
            this.promptAnswers = new Array(prompts.length).fill('');
            this.currentPromptIndex = 0;

            UIUtil.showSection('promptsSection');
            this.displayPrompt();
        } catch (error) {
            UIUtil.showModal(`Failed to fetch prompts: ${error.message}`, 'error');
            this.activePrompts = this.defaultPrompts;
            this.promptAnswers = new Array(this.defaultPrompts.length).fill('');
            this.currentPromptIndex = 0;
            UIUtil.showSection('promptsSection');
            this.displayPrompt();
        } finally {
            UIUtil.setButtonLoading(startBtn, startBtnText, false);
            this.isLoading = false;
        }
    }

    displayPrompt() {
        const promptText = document.getElementById('currentPromptText');
        const promptAnswer = document.getElementById('promptAnswerTextarea');
        const prevBtn = document.getElementById('prevPromptBtn');
        const nextBtn = document.getElementById('nextPromptBtn');
        const combineBtn = document.getElementById('combineAnswersBtn');
        const counter = document.getElementById('promptCounter');

        promptText.textContent = this.activePrompts[this.currentPromptIndex];
        promptAnswer.value = this.promptAnswers[this.currentPromptIndex] || '';
        counter.textContent = `${this.currentPromptIndex + 1}/${this.activePrompts.length}`;

        prevBtn.disabled = this.currentPromptIndex === 0;
        nextBtn.textContent = this.currentPromptIndex === this.activePrompts.length - 1 ? 'Finish' : 'Next Prompt';
        combineBtn.classList.toggle('hidden', this.currentPromptIndex !== this.activePrompts.length - 1);

        UIUtil.updateProgressBar(this.currentPromptIndex + 1, this.activePrompts.length);
        UIUtil.triggerPromptTransition();
        promptAnswer.focus();
    }

    previousPrompt() {
        if (this.currentPromptIndex > 0) {
            this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value;
            this.currentPromptIndex--;
            this.displayPrompt();
        }
    }

    nextPrompt() {
        this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value;
        if (this.currentPromptIndex < this.activePrompts.length - 1) {
            this.currentPromptIndex++;
            this.displayPrompt();
        } else {
            this.combineAnswers();
        }
    }

    async combineAnswers() {
        this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value;
        const journalText = this.promptAnswers
            .map((answer, i) => `**Prompt ${i + 1}: ${this.activePrompts[i]}**\n${answer}`)
            .join('\n\n');

        if (!this.promptAnswers.some(answer => answer.trim())) {
            UIUtil.showModal('Please provide at least one answer.', 'error');
            return;
        }

        this.isLoading = true;
        try {
            const apiKey = StorageUtil.load('geminiApiKey');
            const mood = document.getElementById('journalMood').value;
            const analysis = await GeminiAPI.fetchAnalysis(journalText, mood, apiKey);

            this.displayAnalysisResults(analysis, journalText);
            UIUtil.showSection('analysisSection');
        } catch (error) {
            UIUtil.showModal(`Failed to fetch analysis: ${error.message}`, 'error');
        } finally {
            this.isLoading = false;
        }
    }

    displayAnalysisResults(analysis, journalText) {
        const { summary, action_items_list, key_themes_list, affirmation } = analysis;

        document.getElementById('analysisSummary').textContent = summary || 'No summary provided.';
        const themesList = document.getElementById('keyThemesList');
        themesList.innerHTML = key_themes_list?.map(theme => `<li>${theme}</li>`).join('') || '<li>No themes identified.</li>';
        const actionList = document.getElementById('actionItemsList');
        actionList.innerHTML = action_items_list?.map(item => `<li>${item}</li>`).join('') || '<li>No action items.</li>';
        document.getElementById('affirmationDisplay').textContent = affirmation || 'Keep shining!';
        document.getElementById('combinedJournalText').value = journalText;
    }

    copyJournalText() {
        const journalText = document.getElementById('combinedJournalText').value;
        navigator.clipboard.writeText(journalText)
            .then(() => UIUtil.showModal('Journal text copied to clipboard.', 'success'))
            .catch(() => UIUtil.showModal('Failed to copy text.', 'error'));
    }

    exportToNotion() {
        const journalText = document.getElementById('combinedJournalText').value;
        const date = document.getElementById('journalDate').value;
        const mood = document.getElementById('journalMood').value;
        const markdown = `# Journal Entry - ${date} (${mood})\n\n${journalText.replace(/\*\*/g, '###')}`;
        
        const blob = new Blob([markdown], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `journal_${date}.md`;
        a.click();
        URL.revokeObjectURL(url);
        UIUtil.showModal('Journal exported as Markdown.', 'success');
    }

    handleKeydown(event) {
        if (event.key === 'Enter' && !event.shiftKey && document.activeElement === document.getElementById('promptAnswerTextarea')) {
            event.preventDefault();
            this.nextPrompt();
        }
        if (event.key === 'Escape') {
            UIUtil.hideModal();
        }
    }
}

// Initialize the app
const app = new JournalApp();
</script>
</body>
</html>
