<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #64748b;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --background-color: #f1f5f9;
            --card-background: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --modal-background: rgba(0, 0, 0, 0.5);
        }
        body {
            font-family: 'Pyidaungsu', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        .card {
            background: var(--card-background);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            margin: 1rem auto;
            max-width: 900px;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 1rem;
        }
        .textarea-field {
            min-height: 150px;
            resize: vertical;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: #475569;
        }
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        .btn-success:hover {
            background-color: #16a34a;
        }
        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--modal-background);
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        .loading-spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f4f6;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .prompt-transition {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .prompt-display.active {
            opacity: 1;
        }
        .progress-container {
            width: 100%;
            background: #e2e8f0;
            border-radius: 0.25rem;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-bar {
            height: 0.5rem;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        @media (max-width: 640px) {
            .card {
                padding: 1rem;
            }
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4">
        <div class="card">
            <h1 class="text-3xl font-bold text-center mb-6 text-blue-700">á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h1>
            <div id="app-content" class="space-y-6">
                <!-- Privacy Policy Section -->
                <div id="privacySection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-yellow-600">á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€€á€¬á€€á€½á€šá€ºá€™á€¾á€¯</h2>
                    <div class="space-y-4 text-gray-700">
                        <p>á€¤ App á€á€Šá€º á€á€¯á€¶á€¸á€…á€½á€²á€á€°á€™á€»á€¬á€¸á á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€œá€¯á€¶á€á€¼á€¯á€¶á€›á€±á€¸á€€á€­á€¯ á€¡á€œá€±á€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</p>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">áá‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>á€‚á€»á€¬á€”á€šá€ºá€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ Browser Local Storage á€á€½á€„á€ºá€á€¬ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹</li>
                                <li>Server á€á€­á€¯á€· á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€•á€±á€¸á€•á€­á€¯á€·á€á€¼á€„á€ºá€¸á€™á€›á€¾á€­á€•á€«á‹</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">á‚á‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€–á€±á€¬á€€á€ºá€•á€¼á€¬á€¸á€™á€¾á€¯ á€€á€¬á€€á€½á€šá€ºá€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>á€•á€¼á€„á€ºá€• Server á€™á€¾ á€•á€±á€«á€€á€ºá€€á€¼á€¬á€¸á€”á€­á€¯á€„á€ºá€á€¼á€± á€™á€›á€¾á€­á€•á€«á‹</li>
                                <li>Browser Cache á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€•á€«á€€ á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€•á€»á€±á€¬á€€á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</li>
                            </ul>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="agreePrivacyBtn" class="btn btn-primary">á€á€˜á€±á€¬á€á€°á€á€Šá€º</button>
                    </div>
                </div>

                <!-- Terms Section -->
                <div id="termsSection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-yellow-600">á€…á€Šá€ºá€¸á€™á€»á€‰á€ºá€¸á€”á€¾á€„á€·á€º á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸</h2>
                    <div class="space-y-4 text-gray-700">
                        <p>App á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€¡á€±á€¬á€€á€ºá€•á€« á€…á€Šá€ºá€¸á€™á€»á€‰á€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ á€á€˜á€±á€¬á€á€°á€•á€«á€á€Šá€ºá‹</p>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">áá‹ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€™á€¾á€¯</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€º á€‚á€»á€¬á€”á€šá€ºá€›á€±á€¸á€á€¬á€¸á€›á€”á€ºá€á€¬ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€«á‹</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">á‚á‹ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>á€™á€¾á€á€ºá€á€™á€ºá€¸á€•á€»á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€á€¼á€„á€ºá€¸á€¡á€á€½á€€á€º App á€–á€”á€ºá€á€®á€¸á€á€°á€™á€¾ á€á€¬á€á€”á€ºá€™á€›á€¾á€­á€•á€«á‹</li>
                            </ul>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="agreeTermsBtn" class="btn btn-primary">á€á€˜á€±á€¬á€á€°á€á€Šá€º</button>
                    </div>
                </div>

                <!-- User Guide Section -->
                <div id="guideSection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-blue-700">á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€Šá€½á€¾á€”á€º</h2>
                    <div class="space-y-4 text-gray-700">
                        <div>
                            <h3 class="text-lg font-semibold mb-2">áá‹ á€‚á€»á€¬á€”á€šá€ºá€…á€á€„á€ºá€›á€±á€¸á€á€¬á€¸</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>á€›á€€á€ºá€…á€½á€²á€”á€²á€· á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯ á€›á€½á€±á€¸á€•á€¼á€®á€¸ "á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€‚á€»á€¬á€”á€šá€ºá€›á€±á€¸á€™á€Šá€º" á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€•á€«á‹</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">á‚á‹ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>"á€¡á€–á€¼á€±á€™á€»á€¬á€¸ á€…á€¯á€…á€Šá€ºá€¸á€™á€Šá€º" á€€á€­á€¯ á€”á€¾á€­á€•á€ºá€•á€¼á€®á€¸ á€á€­á€™á€ºá€¸á€•á€«á‹</li>
                            </ul>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="startJournalingBtn" class="btn btn-primary">á€‚á€»á€¬á€”á€šá€ºá€…á€á€„á€ºá€›á€±á€¸á€™á€Šá€º</button>
                    </div>
                </div>

                <!-- API Key Input Section -->
                <div id="apiKeySection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-blue-700">Gemini API Key</h2>
                    <p class="text-gray-600 mb-2">AI á€á€¯á€¶á€¸á€á€•á€ºá€á€»á€€á€ºá€¡á€á€½á€€á€º API Key á€‘á€Šá€·á€ºá€•á€«á‹</p>
                    <p class="text-sm text-gray-500"><a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Google AI Studio</a> á€™á€¾ á€›á€šá€°á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</p>
                    <input type="password" id="apiKeyInput" class="input-field mb-4" placeholder="Enter your Gemini API Key" required>
                    <div class="text-center">
                        <button id="saveApiKeyBtn" class="btn btn-primary">á€á€­á€™á€ºá€¸á€™á€Šá€º</button>
                    </div>
                </div>

                <!-- Main Journal Section -->
                <div id="journalSection" class="section hidden">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="journalDate" class="block text-sm font-medium mb-1">á€›á€€á€ºá€…á€½á€²:</label>
                            <input type="date" id="journalDate" class="input-field" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯:</label>
                            <select id="journalMood" class="input-field">
                                <option value="">á€›á€½á€±á€¸á€•á€«</option>
                                <option value="á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€º">á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€º ğŸ˜Š</option>
                                <option value="á€á€™á€ºá€¸á€”á€Šá€ºá€¸">á€á€™á€ºá€¸á€”á€Šá€ºá€¸ ğŸ˜¢</option>
                                <option value="á€…á€­á€á€ºá€á€­á€¯">á€…á€­á€á€ºá€á€­á€¯ ğŸ˜ </option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4 bg-blue-50 border-l-4 border-blue-500 p-3 rounded-r">
                        <h3 class="text-md font-semibold text-blue-800">á€˜á€á€†á€­á€¯á€„á€ºá€›á€¬ á€á€½á€±á€¸á€á€±á€¬á€ºá€™á€¾á€¯</h3>
                        <p id="philosophyText" class="text-blue-600"></p>
                        <p id="sourceCredit" class="text-xs text-blue-500"></p>
                    </div>
                    <div class="flex justify-center gap-4 mt-4">
                        <button id="startPromptsBtn" class="btn btn-primary">âœ¨ á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€‚á€»á€¬á€”á€šá€ºá€›á€±á€¸á€™á€Šá€º</button>
                        <button id="clearApiKeyBtn" class="btn btn-danger">API Key á€–á€šá€ºá€›á€¾á€¬á€¸á€™á€Šá€º</button>
                    </div>
                    <div class="mt-4">
                        <h3 class="text-md font-semibold mb-2">á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º</h3>
                        <textarea id="feedbackTextarea" class="input-field textarea-field" placeholder="á€á€„á€·á€º á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€›á€±á€¸á€•á€«"></textarea>
                        <div class="text-center mt-2">
                            <button id="submitFeedbackBtn" class="btn btn-success">á€•á€±á€¸á€•á€­á€¯á€·á€™á€Šá€º</button>
                        </div>
                    </div>
                </div>

                <!-- Prompts Section -->
                <div id="promptsSection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">á€‚á€»á€¬á€”á€šá€ºá€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸</h2>
                    <div class="progress-container">
                        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="promptDisplay" class="prompt-display mt-4">
                        <p id="currentPromptText" class="text-lg font-medium text-blue-800 mb-2"></p>
                        <textarea id="promptAnswerTextarea" class="input-field textarea-field" placeholder="á€¡á€–á€¼á€±á€›á€±á€¸á€•á€«"></textarea>
                    </div>
                    <div class="flex justify-between items-center mt-4 gap-2">
                        <button id="prevPromptBtn" class="btn btn-secondary" disabled>á€šá€á€„á€º</button>
                        <span id="promptCounter" class="text-gray-600">1/5</span>
                        <div class="flex gap-2">
                            <button id="nextPromptBtn" class="btn btn-primary">á€”á€±á€¬á€€á€º</button>
                            <button id="combineAnswersBtn" class="btn btn-success hidden">á€…á€¯á€…á€Šá€ºá€¸á€™á€Šá€º</button>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="backToJournalBtn" class="btn btn-secondary">á€•á€¼á€”á€ºá€á€½á€¬á€¸á€™á€Šá€º</button>
                    </div>
                </div>

                <!-- Suggestions Section -->
                <div id="suggestionsSection" class="section hidden">
                    <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€™á€»á€¬á€¸</h2>
                    <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded-r mb-4">
                        <h3 class="text-md font-semibold text-green-800">á€¡á€¬á€¸á€•á€±á€¸á€…á€€á€¬á€¸</h3>
                        <p id="affirmationText" class="text-green-700"></p>
                    </div>
                    <div class="card">
                        <h3 class="text-md font-semibold mb-2">á€‚á€»á€¬á€”á€šá€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
                        <textarea id="combinedJournalText" class="input-field textarea-field" style="min-height: 200px;" readonly></textarea>
                        <div class="flex justify-center gap-4 mt-4">
                            <button id="copyCombinedTextBtn" class="btn btn-success">á€€á€°á€¸á€šá€°á€™á€Šá€º</button>
                            <button id="exportToNotionBtn" class="btn btn-primary">Notion á€‘á€¯á€á€ºá€™á€Šá€º</button>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="backToMainJournalBtn" class="btn btn-secondary">á€•á€¼á€”á€ºá€á€½á€¬á€¸á€™á€Šá€º</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="modal" class="modal" role="dialog" aria-modal="true">
            <div class="modal-content">
                <button id="modalClose" class="modal-close text-2xl">&times;</button>
                <p id="modalMessage" class="text-lg font-medium"></p>
            </div>
        </div>
    </div>

    <script>
        const FALLBACK_AFFIRMATIONS = {
            "á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€º": ["á€á€„á€·á€ºá€›á€²á€· á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€™á€¾á€¯á€€á€­á€¯ á€†á€€á€ºá€œá€€á€ºá€™á€»á€¾á€á€±á€•á€«á‹", "á€’á€®á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€™á€¾á€¯á€€á€­á€¯ á€¡á€™á€¾á€á€ºá€á€›á€‘á€¬á€¸á€•á€«á‹"],
            "á€á€™á€ºá€¸á€”á€Šá€ºá€¸": ["á€á€„á€ºá€á€…á€ºá€šá€±á€¬á€€á€ºá€á€Šá€ºá€¸ á€™á€Ÿá€¯á€á€ºá€•á€«á€˜á€°á€¸á‹", "á€¡á€”á€¬á€¸á€šá€°á€•á€¼á€®á€¸ á€…á€­á€á€ºá€¡á€±á€¸á€œá€­á€¯á€€á€ºá€•á€«á‹"],
            "á€…á€­á€á€ºá€á€­á€¯": ["á€…á€­á€á€ºá€¡á€±á€¸á€¡á€±á€¸á€‘á€¬á€¸á€•á€«á‹", "á€¡á€á€½á€±á€¸á€á€½á€±á€€á€­á€¯ á€›á€±á€¸á€‘á€¯á€á€ºá€€á€¼á€Šá€·á€ºá€•á€«á‹"]
        };

        const StorageUtil = {
            save(key, value) { try { localStorage.setItem(key, JSON.stringify(value)); return true; } catch (e) { console.error(e); return false; } },
            load(key) { try { return JSON.parse(localStorage.getItem(key)) || null; } catch (e) { console.error(e); return null; } },
            remove(key) { try { localStorage.removeItem(key); return true; } catch (e) { console.error(e); return false; } }
        };

        const GeminiAPI = {
            async fetchPrompts(mood, apiKey) {
                const prompt = mood ? `Generate 5 journaling prompts in Burmese for '${mood}' mood. Format: JSON array of strings.` : `Generate 5 journaling prompts in Burmese. Format: JSON array of strings.`;
                return this._makeApiCall(prompt, { type: 'ARRAY', items: { type: 'STRING' } }, apiKey);
            },
            async fetchAffirmation(text, mood, apiKey) {
                const prompt = `Analyze: "${text}"\nMood: ${mood}\nProvide a positive affirmation in Burmese. Return: {"affirmation": "text"}`;
                return this._makeApiCall(prompt, { type: 'OBJECT', properties: { affirmation: { type: 'STRING' } } }, apiKey);
            },
            async _makeApiCall(prompt, schema, apiKey) {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: schema ? { responseSchema: schema } : {} })
                });
                if (!response.ok) throw new Error('API error');
                const result = await response.json();
                return JSON.parse(result.candidates[0].content.parts[0].text);
            }
        };

        const SuggestionModule = {
            async generateAffirmation(text, mood, apiKey) {
                try { return await GeminiAPI.fetchAffirmation(text, mood, apiKey); } catch (e) { return { affirmation: FALLBACK_AFFIRMATIONS[mood]?.[0] || "á€á€„á€ºá€á€Šá€º á€€á€±á€¬á€„á€ºá€¸á€€á€±á€¬á€„á€ºá€¸á€œá€¯á€•á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹" }; }
            }
        };

        const UIUtil = {
            showSection(id) {
                document.querySelectorAll('.section').forEach(s => { s.classList.add('hidden'); s.classList.remove('active'); });
                const section = document.getElementById(id); if (section) { section.classList.remove('hidden'); setTimeout(() => section.classList.add('active'), 50); section.scrollIntoView({ behavior: 'smooth' }); }
            },
            showModal(message, type = 'success') {
                const modal = document.getElementById('modal'); const msg = document.getElementById('modalMessage');
                msg.textContent = message; modal.className = `modal ${type}`; modal.style.display = 'flex'; setTimeout(() => this.hideModal(), 3000);
            },
            hideModal() { document.getElementById('modal').style.display = 'none'; },
            setLoading(el, isLoading, text = el.textContent, spinner = '<span class="loading-spinner"></span>') { el.disabled = isLoading; el.innerHTML = isLoading ? spinner + text : text; },
            updateProgressBar(current, total) { document.getElementById('progressBar').style.width = `${(current / total) * 100}%`; }
        };

        class JournalApp {
            constructor() {
                this.currentPromptIndex = 0; this.promptAnswers = []; this.activePrompts = []; this.defaultPrompts = ["á€’á€®á€”á€±á€· á€˜á€¬á€€á€­á€¯ á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€”á€Šá€ºá€¸á‹", "á€˜á€¬á€€ á€•á€»á€±á€¬á€ºá€…á€±á€á€²á€·á€œá€²á‹", "á€˜á€¬á€€á€­á€¯ á€á€„á€ºá€šá€°á€á€²á€·á€á€œá€²á‹", "á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯á€˜á€šá€ºá€œá€­á€¯á€›á€¾á€­á€á€²á€·á€œá€²á‹", "á€€á€­á€¯á€šá€ºá€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯á€€á€±á€¬á€„á€ºá€¸á€™á€œá€²á‹"];
                this.isLoading = false; this.philosophyTexts = [{ text: "á€”á€±á€·á€…á€‰á€º á€á€¯á€¶á€¸á€á€•á€ºá€á€¬á€€ á€˜á€á€á€­á€¯á€¸á€á€€á€ºá€–á€­á€¯á€· á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€•á€«á€á€šá€ºá‹", credit: "KO LAPYAE" }];
                this.init();
            }
            init() { this.bindEvents(); this.checkInitialState(); this.displayRandomPhilosophy(); }
            bindEvents() {
                document.getElementById('agreePrivacyBtn').addEventListener('click', () => { StorageUtil.save('agreedToPrivacy', 'true'); UIUtil.showSection('termsSection'); });
                document.getElementById('agreeTermsBtn').addEventListener('click', () => { StorageUtil.save('agreedToTerms', 'true'); UIUtil.showSection('guideSection'); });
                document.getElementById('startJournalingBtn').addEventListener('click', () => this.promptForApiKeyOrStartJournaling());
                document.getElementById('saveApiKeyBtn').addEventListener('click', () => this.saveApiKey());
                document.getElementById('clearApiKeyBtn').addEventListener('click', () => this.clearApiKey());
                document.getElementById('startPromptsBtn').addEventListener('click', () => this.startPrompts());
                document.getElementById('submitFeedbackBtn').addEventListener('click', () => this.submitFeedback());
                document.getElementById('prevPromptBtn').addEventListener('click', () => this.previousPrompt());
                document.getElementById('nextPromptBtn').addEventListener('click', () => this.nextPrompt());
                document.getElementById('combineAnswersBtn').addEventListener('click', () => this.combineAnswers());
                document.getElementById('backToJournalBtn').addEventListener('click', () => this.showJournalSection());
                document.getElementById('copyCombinedTextBtn').addEventListener('click', () => this.copyJournalText());
                document.getElementById('exportToNotionBtn').addEventListener('click', () => this.exportToNotion());
                document.getElementById('backToMainJournalBtn').addEventListener('click', () => this.showJournalSection());
                document.getElementById('modalClose').addEventListener('click', () => UIUtil.hideModal());
            }
            checkInitialState() { if (!StorageUtil.load('agreedToPrivacy')) UIUtil.showSection('privacySection'); else if (!StorageUtil.load('agreedToTerms')) UIUtil.showSection('termsSection'); else if (!StorageUtil.load('geminiApiKey')) UIUtil.showSection('apiKeySection'); else this.showJournalSection(); }
            showJournalSection() { UIUtil.showSection('journalSection'); this.setTodayDate(); document.getElementById('journalMood').value = ""; this.displayRandomPhilosophy(); }
            setTodayDate() { document.getElementById('journalDate').value = new Date().toISOString().split('T')[0]; }
            saveApiKey() { const apiKey = document.getElementById('apiKeyInput').value.trim(); if (apiKey) { StorageUtil.save('geminiApiKey', apiKey); UIUtil.showModal('API Key á€á€­á€™á€ºá€¸á€•á€¼á€®á€¸á‹', 'success'); this.showJournalSection(); } else UIUtil.showModal('API Key á€‘á€Šá€·á€ºá€•á€«á‹', 'error'); }
            clearApiKey() { StorageUtil.remove('geminiApiKey'); document.getElementById('apiKeyInput').value = ''; UIUtil.showModal('API Key á€–á€šá€ºá€•á€¼á€®á€¸á‹', 'success'); UIUtil.showSection('apiKeySection'); }
            submitFeedback() { const text = document.getElementById('feedbackTextarea').value.trim(); if (text) { StorageUtil.save('feedback', { text, timestamp: new Date().toISOString() }); document.getElementById('feedbackTextarea').value = ''; UIUtil.showModal('á€•á€±á€¸á€•á€­á€¯á€·á€•á€¼á€®á€¸á‹', 'success'); } else UIUtil.showModal('á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º á€‘á€Šá€·á€ºá€•á€«á‹', 'error'); }
            promptForApiKeyOrStartJournaling() { !StorageUtil.load('geminiApiKey') ? UIUtil.showSection('apiKeySection') : this.showJournalSection(); }
            async startPrompts() { if (this.isLoading) return; const btn = document.getElementById('startPromptsBtn'); UIUtil.setLoading(btn, true); this.isLoading = true; try { const mood = document.getElementById('journalMood').value; if (!mood) { UIUtil.showModal('á€…á€­á€á€ºá€á€¶á€…á€¬á€¸á€™á€¾á€¯ á€›á€½á€±á€¸á€•á€«á‹', 'error'); return; } const apiKey = StorageUtil.load('geminiApiKey'); if (!apiKey) { UIUtil.showModal('API Key á€‘á€Šá€·á€ºá€•á€«á‹', 'error'); UIUtil.showSection('apiKeySection'); return; } this.activePrompts = await GeminiAPI.fetchPrompts(mood, apiKey); this.currentPromptIndex = 0; this.promptAnswers = Array(this.activePrompts.length).fill(''); this.displayCurrentPrompt(); UIUtil.showSection('promptsSection'); } catch (e) { console.error(e); this.activePrompts = this.defaultPrompts; this.currentPromptIndex = 0; this.promptAnswers = Array(this.activePrompts.length).fill(''); this.displayCurrentPrompt(); UIUtil.showSection('promptsSection'); } finally { this.isLoading = false; UIUtil.setLoading(btn, false); } }
            displayCurrentPrompt() { const promptText = document.getElementById('currentPromptText'); const answer = document.getElementById('promptAnswerTextarea'); const counter = document.getElementById('promptCounter'); const prevBtn = document.getElementById('prevPromptBtn'); const nextBtn = document.getElementById('nextPromptBtn'); const combineBtn = document.getElementById('combineAnswersBtn'); promptText.textContent = `${this.currentPromptIndex + 1}. ${this.activePrompts[this.currentPromptIndex]}`; answer.value = this.promptAnswers[this.currentPromptIndex]; answer.focus(); counter.textContent = `${this.currentPromptIndex + 1}/${this.activePrompts.length}`; prevBtn.disabled = this.currentPromptIndex === 0; if (this.currentPromptIndex === this.activePrompts.length - 1) { nextBtn.classList.add('hidden'); combineBtn.classList.remove('hidden'); } else { nextBtn.classList.remove('hidden'); combineBtn.classList.add('hidden'); } UIUtil.updateProgressBar(this.currentPromptIndex + 1, this.activePrompts.length); }
            previousPrompt() { this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value.trim(); this.currentPromptIndex--; this.displayCurrentPrompt(); }
            nextPrompt() { this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value.trim(); this.currentPromptIndex++; this.displayCurrentPrompt(); }
            async combineAnswers() { if (this.isLoading) return; this.isLoading = true; UIUtil.showModal('á€…á€¯á€…á€Šá€ºá€¸á€”á€±á€•á€«á€á€Šá€ºá‹', 'success'); this.promptAnswers[this.currentPromptIndex] = document.getElementById('promptAnswerTextarea').value.trim(); const text = this.promptAnswers.map((a, i) => `${i + 1}. ${this.activePrompts[i]}\n${a}`).join('\n\n---\n\n'); document.getElementById('combinedJournalText').value = text; const mood = document.getElementById('journalMood').value; const apiKey = StorageUtil.load('geminiApiKey'); const result = await SuggestionModule.generateAffirmation(text, mood, apiKey); document.getElementById('affirmationText').textContent = result.affirmation; StorageUtil.save('journalEntry', { date: document.getElementById('journalDate').value, mood, text }); UIUtil.showSection('suggestionsSection'); this.isLoading = false; }
            copyJournalText() { const text = document.getElementById('combinedJournalText').value; navigator.clipboard.writeText(text).then(() => UIUtil.showModal('á€€á€°á€¸á€šá€°á€•á€¼á€®á€¸á‹', 'success')).catch(() => UIUtil.showModal('á€€á€°á€¸á€šá€°á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá‹', 'error')); }
            exportToNotion() { const text = document.getElementById('combinedJournalText').value; const blob = new Blob([`# ${new Date().toLocaleDateString('my-MM')}\n${text}`], { type: 'text/markdown' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `journal_${new Date().toISOString().split('T')[0]}.md`; a.click(); URL.revokeObjectURL(url); UIUtil.showModal('á€‘á€¯á€á€ºá€šá€°á€•á€¼á€®á€¸á‹', 'success'); }
            displayRandomPhilosophy() { const { text, credit } = this.philosophyTexts[Math.floor(Math.random() * this.philosophyTexts.length)]; document.getElementById('philosophyText').textContent = text; document.getElementById('sourceCredit').textContent = credit; }
        }
        document.addEventListener('DOMContentLoaded', () => new JournalApp());
    </script>
</body>
</html>
